var model=function(){function a(a,c){var d,e,f,g=a.nodeName.toLowerCase();return"area"===g?(d=a.parentNode,e=d.name,a.href&&e&&"map"===d.nodeName.toLowerCase()?(f=$("img[usemap=#"+e+"]")[0],!!f&&b(f)):!1):(/input|select|textarea|button|object/.test(g)?!a.disabled:"a"===g?a.href||c:c)&&b(a)}function b(a){return $.expr.filters.visible(a)&&!$(a).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}function c(){var a=999;return $(".ltCont .ltLayer").each(function(){var b=parseInt($(this).css("z-index"));b>a&&(a=b)}),a}var d=function(){var a={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var b in a)if(void 0!==document.documentElement.style[b])return a[b]}();$.expr[":"].focusable=function(b){return a(b,!isNaN($.attr(b,"tabindex")))};var e={is_options_valid:function(a){return a&&a.model&&1===a.model.prop("nodeType")?!0:!1},switchClass:function(a,b){this.removeClass(a).addClass(b)}},f={model:null,dimens:{height:"auto",width:"auto"},resetForm:!1,fixed:!1,zLayer:!0,open:{success:function(){},event:"click",selector:null,anim:""},close:{esc:!0,layer:!0,nodes:{target:"",event:"click",selector:""},success:function(){},returnFocus:!0,anim:""}},g=function(){var a=$('<div class="ltCont close"></div>').attr("tabIndex",0),b=$('<div class="ltLayer close"></div>');return a.append(b),$(window).bind("resize",function(){if(g.stack.length){var a=g.stack[0];a.resize()}}),$("html").keydown(function(a){27===a.keyCode&&g.stack.length&&g.stack[0].options.close.esc&&g.stack[0].close()}),b.click(function(){g.stack.length&&g.stack[0].options.close.layer&&g.stack[0].close()}),{stack:[],cont:a,layer:b}}();$(function(){$("body").append(g.cont)});var h=(function(){g.cont.keydown(function(a){if(g.stack.length&&9===a.keyCode){var b=g.stack[0].options.model.find(":focusable"),c=b.first(),d=b.last();return a.target!==d[0]&&a.target!==a.currentTarget||a.shiftKey?a.target!==c[0]&&a.target!==a.currentTarget||!a.shiftKey?void a.stopPropagation():(d?d.focus():"",!1):(c?c.focus():"",!1)}}),$("html").keydown(function(a){return 9===a.keyCode&&g.stack.length?(g.cont.focus(),!1):void 0})}(),function(){this.options.model.css({position:this.options.fixed?"fixed":"absolute",width:this.options.dimens.width,height:this.options.dimens.height})}),i=function(a){this.options=$.extend(!0,{},this.default_opt,a)},j=function(){var a=this.options.model.parent();a.hasClass("ltCont")||g.cont.append(this.options.model)},k={open:function(){var a=[this.options.close.anim,this.options.open.anim];e.switchClass.apply(this.options.model,a)},close:function(){var a=[this.options.open.anim,this.options.close.anim];e.switchClass.apply(this.options.model,a)}},l=function(){var a=document.documentElement.scrollTop,b=this.options.open.firstFocus;b?b.focus():g.cont.focus(),document.documentElement.scrollTop=a},m=function(){if(this.options.resetForm)for(var a=this.options.model.find("form"),b=0;b<a.length;b++)a[b].reset()},n=function(){if(!g.stack.length){var a=this.options.close.returnFocus;a===!0?this.options.trigger.focus():$(a).focus()}},o=function(){if(this.options.model.removeClass("model_open"),this.options.model.css("zIndex","-1"),g.stack.length){var a=g.stack[0];g.layer.css("zIndex",a.options.model.css("zIndex"))}else g.cont.addClass("close");n.call(this),m.call(this),this.options.close.success()},p=function(){var a=this;this.openEventHandler=function(){a.open()},this.options.trigger.on(this.options.open.event+"."+this.pluginName,this.openEventHandler),q.call(this,this.options.close.nodes),this.options.model.on(d,function(){"close"==a.state&&o.call(a)})},q=function(a){var b=this;if("array"===$.type(a))return void $.each(a,function(a,c){q.call(b,c)});var c=null;a.constructor===jQuery?(c=$.extend({},this.default_opt.close.nodes),c.target=a):c={target:$(a.target),event:a.event,selector:a.selector},c.target.on(c.event,c.selector,function(){b.close()})},r=function(a){i.call(this,a),this.init_structure(),h.call(this),p.call(this),this.options.model.addClass(this.options.close.anim)},s=function(){this.options.trigger.off(this.options.open.event+"."+this.pluginName)},t=function(){this.options.trigger.off(this.options.open.event,this.openEventHandler)},u=function(){this.options.trigger.on(this.options.open.event,this.openEventHandler)},v=function(){model.lt.cont.css({width:"auto",height:"auto"});var a=$(document).height(),b=$(document).width();model.lt.cont.css({width:b+"px",height:a+"px"})},w=function(){this.state="open",g.stack.length||(g.cont.removeClass("close"),this.util.switchClass.call(g.layer,"close","open")),m.call(this);var a=c();this.options.zLayer&&g.layer.css("zIndex",a+3),g.cont.css("zIndex",a+1),this.options.model.css("zIndex",a+3),-1===$.inArray(this,g.stack)&&g.stack.unshift(this),this.options.model.addClass("model_open"),this.resize(),k.open.call(this),l.call(this),this.options.open.success()},x=function(a,b){a=a||$(g.stack).index(this),!g.stack.length||0>a||(this.state="close",g.stack.splice(a,1),d&&!b&&this.options.open.anim?k.close.call(this):o.call(this),g.stack.length||this.util.switchClass.call(g.layer,"open","close"))},y=function(a){function b(a,b){var c=b.data("model");c&&c.options&&c.options.model[0]===a.model[0]&&s.call(this),a.trigger=b,r.call(this,a)}var c=function(){};c.prototype=model;var d=new c;return d.pluginName=a,b.prototype=d,b};return{pluginName:"",state:"close",util:e,lt:g,reInit:s,close_returnFocus:n,getNewModel:y,open:w,close:x,on:u,off:t,resize:v,default_opt:f,init_structure:j}}();